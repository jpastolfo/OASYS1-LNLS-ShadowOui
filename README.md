# OASYS1-LNLS-ShadowOui
Widgets developed by the Brazilian Synchrotron Light Laboratory (LNLS) - Optics Group - with useful functions for OASYS1 

## Widgets

### Flux Widget
The Flux widget calculates the total flux (in units of ph/s) and power (in Watts) after any ShadowOui optical element or at sample position. This is done by calculating the source spectrum and convolving with the beamline energy-dependent transmittance calculated with ShadowOui.

![gui](https://github.com/oasys-lnls-kit/OASYS1-LNLS-ShadowOui/blob/master/images/FluxWidgetGUI.png "GUI")

The Bending Magnet and Wiggler spectrum is calculated analytically as in [X-ray Data Booklet](http://xdb.lbl.gov/). The correct (not gaussian approximation) vertical angular distribution of the source is computed to account for partial acceptance of the vertical divergence. This enables optimization of the simulation when the beamline vertical acceptance is not total. 

The Linear Undulator (elliptical undulator is to be implemented soon) source spectrum is calculated numerically using [SRW](https://github.com/ochubar/SRW) (Synchrotron Radiation Workshop) code (see ref. [1]), taking into account the energy spread and finite emittance of the electron beam. SRW is natively shipped with OASYS1 and should be enabled.

### Examples 

See the [Examples Folder](examples) for a few examples and usage tips of the Flux Widget.

To use Flux Widget, just link the desired optical element (or source) widget to the Flux Widget and modify the parameters corresponding to the source.

**IMPORTANT**: Flux Widget calculates the beamline transmission using the **Begin.dat** file. Therefore, to use the Flux Widget, the user must enable writing the `Begin.dat` file in the ShadowOui source widget (such as Geometrical Source, Bending Magnet widgets). 
ALSO, THE USER MUST ALWAYS MAKE SURE THAT THE `Begin.dat` FILE IN THE WORKSPACE FOLDER INDEED CORRESPOND TO THE CURRENT SIMULATION! For instance, when there are more than one workspace in the same folder (or more than one source widget in the same workspace), it is possible that the Flux Widget gives very weird results (or evern small deviations, which are harder to detect) due to use of an incorrect `Begin.dat` file generated by another simulation/configuration! 

To degub the results, all the intermediate steps of the calculation are shown in other tabs (Source Spectrum, Beamline Transmittance, Hitograms, Source Acceptance and Output). As exaplained above, most errors are due to an old `Begin.dat` file being used, so please run the source widget again and check the results.

### Method Details

![method](https://github.com/oasys-lnls-kit/OASYS1-LNLS-ShadowOui/blob/master/images/flux_method.png "Flux Method")

## References

[1] [O. Chubar and P. Elleaume, Proc. EPAC-98, 1177 - 1179 (1998)](https://accelconf.web.cern.ch/AccelConf/e98/PAPERS/THP01G.PDF).

## Authors

- Artur Clarindo Pinto (artur.pinto@lnls.br)
- Sergio Augusto Lordano Luiz (sergio.lordano@lnls.br)
- Bernd Christian Meyer (bernd.meyer@lnls.br)

## License

This project is licensed under the MIT License - see the [LICENSE.md](LICENSE.md) file for details

## Acknowledgements

The LNLS Optics Group is very grateful to Luca Rebuffi and Manuel Sanchez del Rio, for their developments in optical simulation and colaboration on this project. 
