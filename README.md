# OASYS1-LNLS-ShadowOui
Widgets developed by the Brazilian Synchrotron Light Laboratory (LNLS) - Optics Group - with useful functions for OASYS1 

## Widgets

### Flux Widget
The Flux widget calculates the total flux (in units of ph/s) and power (in Watts) after any ShadowOui optical element or at sample position. This is done by calculating the source spectrum and convolving with the beamline energy-dependent transmittance calculated with ShadowOui.

#### Bending Magnet

The Bending Magnet spectrum is calculated analytically as in X-ray Data Booklet [add link]. The analytical vertical angular distribution of the source is computed to account for partial acceptance of the vertical divergence. [reference] 

#### Wiggler

The Wiggler spectrum is also calculated analytically as in X-ray Data Booklet [add link]. The analytical vertical angular distribution of the source is computed to account for partial acceptance of the vertical divergence. [reference]

#### Undulator

The Undulator (linear or elliptical) source spectrum is calculated numerically using SRW (Synchrotron Radiation Workshop) code [reference], taking into account the energy spread and finite emmitance of the electron beam.



## Examples 

## Method Details

The total flux **F** a at particular position in the beamline can be expressed as:

[equation](latex.codecogs.com/gif.download?%24%24F%20%3D%20%5Cint_%7BE_i%7D%5E%7BE_f%7D%20F%28E%29%20%5C%20dE%20%24%24)

[equation](latex.codecogs.com/gif.latex?%24%24F%20%3D%20%5Cint_%7BE_i%7D%5E%7BE_f%7D%20F%28E%29%20%5C%20dE%20%24%24)

where  **F(E)** is the spectral flux at that postion, which in turns is related to the source spectral flux **Fs(E)** and the beamline energy-dependent transmission **T(E)** as: 

$$F(E) = F_s(E) \ T(E)$$

[equation](latex.codecogs.com/gif.download?%24%24F%28E%29%20%3D%20F_s%28E%29%20%5C%20T%28E%29%24%24)

For the power calculation, it can be noted that a bunch of $N$ photons with equal energy $E_i$ comprises a total energy $N * E_i$, and in a time interval the number of photons is $N = F(E) \Delta t$, the power within an infinitesimal bandwidth is $dP = F(E)\ E \ dE$, so the integrated power is:
$$P = \int_{E_i}^{E_f} F(E)\ E \ dE $$

Now, the beamline transmission is accurately calculated by SHADOW, and can be retrieved from the intensity spectrum generated by the source $I_s$ and the spectrum after some optical element or beamline $I_b$:

$$T(E) = I_b(E)\ /\ I_s(E)$$

where $I_b(E)$ and $I_s(E)$ are simply the proper energy histrograms of the rays weighted by their intensities. Note that this division gives the correct spectral transmittance for any arbitrary energy distribution at the source in SHADOW, provided there are enough good rays inside the energy interval of interest. 

## References

[1] 
[2]
[3] 

## Authors

- Artur Clarindo Pinto
- Sergio Augusto Lordano Luiz
- Bernd Christian Meyer

## License

This project is licensed under the MIT License - see the [LICENSE.md](LICENSE.md) file for details

## Acknowledgements

The LNLS Optics Group is very grateful to Luca Rebuffi and Manuel Sanchez del Rio, for their developments in optical simulation and colaboration on this project. 
